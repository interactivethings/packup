#!/usr/bin/env node

var path = require('path');
var minimist = require('minimist');
var portfinder = require('portfinder');
var packup = require('../index');

var argv = minimist(process.argv.slice(2), {
  alias: {
    p: ['port']
  }
});

var src = argv._[0] || '.';
var entryFile = path.join(process.cwd(), src, path.extname(src) === '.js' ? '' : 'index.js');

if (argv.port) {
  packup(argv.port, entryFile);
} else {
  portfinder.getPort({port: 8080, host: '127.0.0.1'}, function(err, port) {
    if (err) { throw err; }
    packup(port, entryFile);
  });
}
